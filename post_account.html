<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Dashboard - Fadis Youth</title>
  <!-- Firebase Libraries -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #4361ee;
      --primary-light: #4895ef;
      --secondary: #3f37c9;
      --accent: #f72585;
      --dark: #1a1a2e;
      --light: #f8f9fa;
      --success: #4cc9f0;
      --warning: #f8961e;
      --danger: #ef233c;
      --gray: #6c757d;
      --gray-light: #e9ecef;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.1), 0 1px 3px rgba(0,0,0,0.08);
      --shadow-lg: 0 10px 20px rgba(0,0,0,0.1), 0 6px 6px rgba(0,0,0,0.1);
      --shadow-xl: 0 15px 25px rgba(0,0,0,0.1), 0 10px 10px rgba(0,0,0,0.08);
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f5f7fa;
      color: var(--dark);
      line-height: 1.6;
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: var(--gray-light);
    }
    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: var(--secondary);
    }

    /* Dashboard Layout */
    .dashboard-container {
      display: grid;
      grid-template-columns: 250px 1fr;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 20px 0;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 20px;
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      font-size: 1.5rem;
      color: white;
      text-decoration: none;
      margin-bottom: 20px;
    }

    .sidebar-logo i {
      font-size: 1.8rem;
      color: var(--accent);
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(45deg, var(--accent), var(--warning));
      color: white;
      font-weight: bold;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid white;
    }

    .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }

    .user-info {
      flex-grow: 1;
    }

    .user-name {
      font-weight: 600;
      margin-bottom: 3px;
    }

    .user-role {
      font-size: 0.8rem;
      opacity: 0.8;
    }

    .sidebar-menu {
      list-style: none;
      padding: 0 10px;
    }

    .sidebar-menu li {
      margin-bottom: 5px;
    }

    .sidebar-menu a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 15px;
      border-radius: 8px;
      color: white;
      text-decoration: none;
      transition: var(--transition);
      font-size: 0.95rem;
    }

    .sidebar-menu a:hover, .sidebar-menu a.active {
      background: rgba(255,255,255,0.1);
    }

    .sidebar-menu a i {
      width: 20px;
      text-align: center;
      font-size: 1.1rem;
    }

    .sidebar-menu .notification-badge {
      margin-left: auto;
      background: var(--accent);
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      font-weight: bold;
    }

    /* Main Content */
    .main-content {
      background-color: var(--light);
      padding: 20px;
    }

    /* Top Navigation */
    .top-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: white;
      border-radius: 10px;
      box-shadow: var(--shadow-sm);
      margin-bottom: 20px;
    }

    .page-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--dark);
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .search-container {
      position: relative;
      width: 250px;
    }

    .search-box {
      width: 100%;
      padding: 10px 15px 10px 40px;
      border: 1px solid var(--gray-light);
      border-radius: 25px;
      outline: none;
      font-size: 0.95rem;
      transition: var(--transition);
    }

    .search-box:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
    }

    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      pointer-events: none;
    }

    .notification-btn {
      position: relative;
      background: none;
      border: none;
      color: var(--gray);
      font-size: 1.2rem;
      cursor: pointer;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger);
      color: white;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.6rem;
      font-weight: bold;
    }

    /* Dashboard Cards */
    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .dashboard-card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
    }

    .dashboard-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-md);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .card-icon {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      color: white;
    }

    .card-icon.posts {
      background: linear-gradient(45deg, var(--primary), var(--primary-light));
    }

    .card-icon.followers {
      background: linear-gradient(45deg, var(--success), #4cc9f0);
    }

    .card-icon.following {
      background: linear-gradient(45deg, var(--warning), #f8961e);
    }

    .card-icon.likes {
      background: linear-gradient(45deg, var(--accent), #f72585);
    }

    .card-title {
      font-size: 0.9rem;
      color: var(--gray);
    }

    .card-value {
      font-size: 1.8rem;
      font-weight: 700;
      margin: 5px 0;
    }

    .card-change {
      font-size: 0.8rem;
      display: flex;
      align-items: center;
      gap: 3px;
    }

    .card-change.positive {
      color: var(--success);
    }

    .card-change.negative {
      color: var(--danger);
    }

    /* Dashboard Sections */
    .dashboard-section {
      background: white;
      border-radius: 10px;
      box-shadow: var(--shadow-sm);
      padding: 20px;
      margin-bottom: 20px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--gray-light);
    }

    .section-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--dark);
    }

    .section-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 25px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
    }

    .btn-primary:hover {
      background: var(--secondary);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn-outline {
      background: none;
      border: 1px solid var(--gray-light);
      color: var(--dark);
    }

    .btn-outline:hover {
      background: var(--gray-light);
    }

    /* Recent Activity */
    .activity-list {
      list-style: none;
    }

    .activity-item {
      display: flex;
      gap: 15px;
      padding: 15px 0;
      border-bottom: 1px solid var(--gray-light);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--gray-light);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .activity-content {
      flex-grow: 1;
    }

    .activity-text {
      margin-bottom: 5px;
      font-size: 0.95rem;
    }

    .activity-time {
      font-size: 0.8rem;
      color: var(--gray);
    }

    /* Recent Posts */
    .post-list {
      list-style: none;
    }

    .post-item {
      padding: 15px 0;
      border-bottom: 1px solid var(--gray-light);
    }

    .post-item:last-child {
      border-bottom: none;
    }

    .post-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .post-title {
      font-weight: 600;
      color: var(--dark);
    }

    .post-meta {
      display: flex;
      gap: 10px;
      font-size: 0.85rem;
      color: var(--gray);
    }

    .post-content {
      font-size: 0.95rem;
      margin-bottom: 10px;
      line-height: 1.6;
    }

    .post-actions {
      display: flex;
      gap: 15px;
    }

    .post-action {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.85rem;
      color: var(--gray);
      cursor: pointer;
    }

    .post-action:hover {
      color: var(--primary);
    }

    /* Profile Settings */
    .profile-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--dark);
    }

    .form-control {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid var(--gray-light);
      border-radius: 8px;
      font-family: inherit;
      transition: var(--transition);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.2);
    }

    .avatar-upload {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .avatar-preview {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: var(--gray-light);
      overflow: hidden;
      position: relative;
    }

    .avatar-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-upload-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .avatar-upload-btn:hover {
      background: var(--secondary);
    }

    .form-section-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 20px 0 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid var(--gray-light);
      grid-column: span 2;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: white;
      border-radius: 15px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-xl);
      transform: translateY(-20px);
      transition: all 0.3s ease;
      position: relative;
    }

    .modal.active .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      padding: 20px;
      border-bottom: 1px solid var(--gray-light);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--dark);
    }

    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--gray);
      cursor: pointer;
      transition: var(--transition);
    }

    .close-modal:hover {
      color: var(--danger);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid var(--gray-light);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    /* Toast Notifications */
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--dark);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: var(--shadow-lg);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      transition: all 0.3s ease;
    }

    .toast.show {
      opacity: 1;
      bottom: 30px;
    }

    .toast.success {
      background: var(--success);
    }

    .toast.error {
      background: var(--danger);
    }

    .toast.warning {
      background: var(--warning);
    }

    /* Dark Mode */
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }

    body.dark-mode .main-content {
      background-color: #1e1e1e;
    }

    body.dark-mode .top-nav,
    body.dark-mode .dashboard-card,
    body.dark-mode .dashboard-section,
    body.dark-mode .modal-content {
      background-color: #1e1e1e;
      color: #e0e0e0;
    }

    body.dark-mode .page-title,
    body.dark-mode .section-title,
    body.dark-mode .modal-title,
    body.dark-mode .post-title,
    body.dark-mode .form-label {
      color: #ffffff;
    }

    body.dark-mode .card-title,
    body.dark-mode .activity-time,
    body.dark-mode .post-meta,
    body.dark-mode .post-action {
      color: #b0b0b0;
    }

    body.dark-mode .search-box,
    body.dark-mode .form-control {
      background-color: #2d2d2d;
      border-color: #333;
      color: #e0e0e0;
    }

    body.dark-mode .search-box:focus,
    body.dark-mode .form-control:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(67, 97, 238, 0.3);
    }

    body.dark-mode .btn-outline {
      border-color: #444;
      color: #e0e0e0;
    }

    body.dark-mode .btn-outline:hover {
      background-color: #333;
    }

    body.dark-mode .section-header,
    body.dark-mode .activity-item,
    body.dark-mode .post-item {
      border-color: #333;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .dashboard-container {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        display: none;
      }
      
      .top-nav {
        padding: 12px 15px;
      }
    }

    @media (max-width: 768px) {
      .profile-form {
        grid-template-columns: 1fr;
      }
      
      .form-section-title {
        grid-column: span 1;
      }
      
      .dashboard-cards {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 576px) {
      .dashboard-cards {
        grid-template-columns: 1fr;
      }
      
      .top-nav {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }
      
      .nav-right {
        width: 100%;
      }
      
      .search-container {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-header">
        <a href="#" class="sidebar-logo">
          <i class="fas fa-mosque"></i>
          <span>Fadis Youth</span>
        </a>
        
        <div class="user-profile">
          <div class="user-avatar" id="userAvatar">
            <i class="fas fa-user"></i>
          </div>
          <div class="user-info">
            <div class="user-name" id="userName">Loading...</div>
            <div class="user-role" id="userRole">Member</div>
          </div>
        </div>
      </div>
      
      <ul class="sidebar-menu">
        <li><a href="#" class="active" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
        <li><a href="#" onclick="showSection('profile')"><i class="fas fa-user"></i> My Profile</a></li>
        <li><a href="#" onclick="showSection('posts')"><i class="fas fa-file-alt"></i> My Posts</a></li>
        <li><a href="#" onclick="showSection('followers')"><i class="fas fa-users"></i> Followers <span class="notification-badge">3</span></a></li>
        <li><a href="#" onclick="showSection('following')"><i class="fas fa-user-friends"></i> Following</a></li>
        <li><a href="#" onclick="showSection('notifications')"><i class="fas fa-bell"></i> Notifications <span class="notification-badge">5</span></a></li>
        <li><a href="#" onclick="showSection('messages')"><i class="fas fa-envelope"></i> Messages</a></li>
        <li><a href="#" onclick="showSection('settings')"><i class="fas fa-cog"></i> Settings</a></li>
        <li><a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
      </ul>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
      <!-- Top Navigation -->
      <div class="top-nav">
        <h1 class="page-title" id="pageTitle">Dashboard</h1>
        
        <div class="nav-right">
          <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-box" placeholder="Search dashboard...">
          </div>
          
          <button class="notification-btn">
            <i class="fas fa-bell"></i>
            <span class="notification-badge">5</span>
          </button>
        </div>
      </div>
      
      <!-- Dashboard Section -->
      <div id="dashboardSection" class="dashboard-section">
        <div class="dashboard-cards">
          <div class="dashboard-card">
            <div class="card-header">
              <div>
                <div class="card-title">My Posts</div>
                <div class="card-value" id="postsCount">0</div>
                <div class="card-change positive">
                  <i class="fas fa-arrow-up"></i> 12% from last week
                </div>
              </div>
              <div class="card-icon posts">
                <i class="fas fa-file-alt"></i>
              </div>
            </div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-header">
              <div>
                <div class="card-title">Followers</div>
                <div class="card-value" id="followersCount">0</div>
                <div class="card-change positive">
                  <i class="fas fa-arrow-up"></i> 5 new followers
                </div>
              </div>
              <div class="card-icon followers">
                <i class="fas fa-users"></i>
              </div>
            </div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-header">
              <div>
                <div class="card-title">Following</div>
                <div class="card-value" id="followingCount">0</div>
                <div class="card-change negative">
                  <i class="fas fa-arrow-down"></i> 2 unfollowed
                </div>
              </div>
              <div class="card-icon following">
                <i class="fas fa-user-friends"></i>
              </div>
            </div>
          </div>
          
          <div class="dashboard-card">
            <div class="card-header">
              <div>
                <div class="card-title">Post Likes</div>
                <div class="card-value" id="likesCount">0</div>
                <div class="card-change positive">
                  <i class="fas fa-arrow-up"></i> 24% from last week
                </div>
              </div>
              <div class="card-icon likes">
                <i class="fas fa-heart"></i>
              </div>
            </div>
          </div>
        </div>
        
        <div class="dashboard-section">
          <div class="section-header">
            <h2 class="section-title">Recent Activity</h2>
            <div class="section-actions">
              <button class="btn btn-outline">View All</button>
            </div>
          </div>
          
          <ul class="activity-list" id="recentActivity">
            <li class="activity-item">
              <div class="activity-avatar">
                <i class="fas fa-user"></i>
              </div>
              <div class="activity-content">
                <p class="activity-text">Ahmed Ali liked your post "Ramadan Preparation Tips"</p>
                <div class="activity-time">2 hours ago</div>
              </div>
            </li>
            <li class="activity-item">
              <div class="activity-avatar">
                <i class="fas fa-user"></i>
              </div>
              <div class="activity-content">
                <p class="activity-text">Mariam Yusuf started following you</p>
                <div class="activity-time">5 hours ago</div>
              </div>
            </li>
            <li class="activity-item">
              <div class="activity-avatar">
                <i class="fas fa-user"></i>
              </div>
              <div class="activity-content">
                <p class="activity-text">You posted "The Importance of Patience in Islam"</p>
                <div class="activity-time">1 day ago</div>
              </div>
            </li>
          </ul>
        </div>
        
        <div class="dashboard-section">
          <div class="section-header">
            <h2 class="section-title">Recent Posts</h2>
            <div class="section-actions">
              <button class="btn btn-primary" onclick="showSection('posts')">
                <i class="fas fa-plus"></i> New Post
              </button>
            </div>
          </div>
          
          <ul class="post-list" id="recentPosts">
            <li class="post-item">
              <div class="post-header">
                <h3 class="post-title">Ramadan Preparation Tips</h3>
                <div class="post-meta">
                  <span><i class="far fa-eye"></i> 245</span>
                  <span><i class="far fa-heart"></i> 56</span>
                  <span><i class="far fa-comment"></i> 12</span>
                </div>
              </div>
              <div class="post-content">
                Practical tips to prepare spiritually and physically for the blessed month of Ramadan...
              </div>
              <div class="post-actions">
                <div class="post-action" onclick="editPost('post1')">
                  <i class="fas fa-edit"></i> Edit
                </div>
                <div class="post-action" onclick="viewPost('post1')">
                  <i class="fas fa-external-link-alt"></i> View
                </div>
                <div class="post-action" onclick="deletePost('post1')">
                  <i class="fas fa-trash"></i> Delete
                </div>
              </div>
            </li>
            <li class="post-item">
              <div class="post-header">
                <h3 class="post-title">The Importance of Patience in Islam</h3>
                <div class="post-meta">
                  <span><i class="far fa-eye"></i> 189</span>
                  <span><i class="far fa-heart"></i> 42</span>
                  <span><i class="far fa-comment"></i> 8</span>
                </div>
              </div>
              <div class="post-content">
                Exploring the concept of Sabr in Islam and how it applies to our daily lives as Muslims...
              </div>
              <div class="post-actions">
                <div class="post-action">
                  <i class="fas fa-edit"></i> Edit
                </div>
                <div class="post-action">
                  <i class="fas fa-external-link-alt"></i> View
                </div>
                <div class="post-action">
                  <i class="fas fa-trash"></i> Delete
                </div>
              </div>
            </li>
          </ul>
        </div>
      </div>
      
      <!-- Profile Section (Hidden by default) -->
      <div id="profileSection" class="dashboard-section" style="display:none;">
        <div class="section-header">
          <h2 class="section-title">My Profile</h2>
          <div class="section-actions">
            <button class="btn btn-primary" onclick="saveProfile()">
              <i class="fas fa-save"></i> Save Changes
            </button>
          </div>
        </div>
        
        <form id="profileForm" class="profile-form">
          <h3 class="form-section-title">Basic Information</h3>
          
          <div class="form-group">
            <label class="form-label">First Name</label>
            <input type="text" class="form-control" id="firstName" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Last Name</label>
            <input type="text" class="form-control" id="lastName" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Display Name</label>
            <input type="text" class="form-control" id="displayName" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" id="email" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Bio</label>
            <textarea class="form-control" id="bio" rows="3"></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Profile Picture</label>
            <div class="avatar-upload">
              <div class="avatar-preview" id="avatarPreview">
                <img src="" alt="Profile Picture" id="avatarImage">
              </div>
              <div>
                <button type="button" class="avatar-upload-btn" onclick="document.getElementById('avatarUpload').click()">
                  <i class="fas fa-upload"></i> Upload Photo
                </button>
                <input type="file" id="avatarUpload" accept="image/*" style="display:none;">
              </div>
            </div>
          </div>
          
          <h3 class="form-section-title">Additional Information</h3>
          
          <div class="form-group">
            <label class="form-label">Location</label>
            <input type="text" class="form-control" id="location">
          </div>
          
          <div class="form-group">
            <label class="form-label">Website</label>
            <input type="url" class="form-control" id="website">
          </div>
          
          <div class="form-group">
            <label class="form-label">Interests</label>
            <input type="text" class="form-control" id="interests" placeholder="Separate with commas">
          </div>
        </form>
      </div>
      
      <!-- Posts Section (Hidden by default) -->
      <div id="postsSection" class="dashboard-section" style="display:none;">
        <div class="section-header">
          <h2 class="section-title">My Posts</h2>
          <div class="section-actions">
            <button class="btn btn-primary" onclick="showNewPostModal()">
              <i class="fas fa-plus"></i> New Post
            </button>
          </div>
        </div>
        
        <div class="post-filters">
          <button class="btn btn-outline active">All Posts</button>
          <button class="btn btn-outline">Published</button>
          <button class="btn btn-outline">Drafts</button>
          <button class="btn btn-outline">Archived</button>
        </div>
        
        <ul class="post-list" id="userPostsList">
          <!-- Posts will be loaded here -->
        </ul>
      </div>
      
      <!-- Followers Section (Hidden by default) -->
      <div id="followersSection" class="dashboard-section" style="display:none;">
        <div class="section-header">
          <h2 class="section-title">My Followers</h2>
          <div class="section-actions">
            <button class="btn btn-outline">View All</button>
          </div>
        </div>
        
        <div class="followers-list" id="followersList">
          <!-- Followers will be loaded here -->
        </div>
      </div>
      
      <!-- Following Section (Hidden by default) -->
      <div id="followingSection" class="dashboard-section" style="display:none;">
        <div class="section-header">
          <h2 class="section-title">People I Follow</h2>
          <div class="section-actions">
            <button class="btn btn-outline">View All</button>
          </div>
        </div>
        
        <div class="following-list" id="followingList">
          <!-- Following will be loaded here -->
        </div>
      </div>
      
      <!-- Notifications Section (Hidden by default) -->
      <div id="notificationsSection" class="dashboard-section" style="display:none;">
        <div class="section-header">
          <h2 class="section-title">Notifications</h2>
          <div class="section-actions">
            <button class="btn btn-outline">Mark All as Read</button>
          </div>
        </div>
        
        <div class="notifications-list" id="notificationsList">
          <!-- Notifications will be loaded here -->
        </div>
      </div>
      
      <!-- Messages Section (Hidden by default) -->
      <div id="messagesSection" class="dashboard-section" style="display:none;">
        <div class="section-header">
          <h2 class="section-title">Messages</h2>
          <div class="section-actions">
            <button class="btn btn-primary">
              <i class="fas fa-plus"></i> New Message
            </button>
          </div>
        </div>
        
        <div class="messages-container">
          <!-- Messages will be loaded here -->
        </div>
      </div>
      
      <!-- Settings Section (Hidden by default) -->
      <div id="settingsSection" class="dashboard-section" style="display:none;">
        <div class="section-header">
          <h2 class="section-title">Account Settings</h2>
          <div class="section-actions">
            <button class="btn btn-primary" onclick="saveSettings()">
              <i class="fas fa-save"></i> Save Changes
            </button>
          </div>
        </div>
        
        <form id="settingsForm" class="profile-form">
          <h3 class="form-section-title">Account Settings</h3>
          
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-control" id="settingsEmail" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Current Password</label>
            <input type="password" class="form-control" id="currentPassword">
          </div>
          
          <div class="form-group">
            <label class="form-label">New Password</label>
            <input type="password" class="form-control" id="newPassword">
          </div>
          
          <div class="form-group">
            <label class="form-label">Confirm New Password</label>
            <input type="password" class="form-control" id="confirmPassword">
          </div>
          
          <h3 class="form-section-title">Notification Preferences</h3>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="emailNotifications" checked> Email Notifications
            </label>
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="pushNotifications" checked> Push Notifications
            </label>
          </div>
          
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" id="messageNotifications" checked> Message Notifications
            </label>
          </div>
          
          <h3 class="form-section-title">Privacy Settings</h3>
          
          <div class="form-group">
            <label class="form-label">Profile Visibility</label>
            <select class="form-control" id="profileVisibility">
              <option value="public">Public</option>
              <option value="friends">Friends Only</option>
              <option value="private">Private</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Who can message you</label>
            <select class="form-control" id="messagePrivacy">
              <option value="everyone">Everyone</option>
              <option value="friends">Friends Only</option>
              <option value="none">No one</option>
            </select>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- New Post Modal -->
  <div class="modal" id="newPostModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Create New Post</h3>
        <button class="close-modal" onclick="closeModal('newPostModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="newPostForm">
          <div class="form-group">
            <label class="form-label">Post Title</label>
            <input type="text" class="form-control" id="postTitle" required>
          </div>
          
          <div class="form-group">
            <label class="form-label">Post Content</label>
            <textarea class="form-control" id="postContent" rows="8" required></textarea>
          </div>
          
          <div class="form-group">
            <label class="form-label">Tags (separate with commas)</label>
            <input type="text" class="form-control" id="postTags" placeholder="ramadan, islam, spirituality">
          </div>
          
          <div class="form-group">
            <label class="form-label">Visibility</label>
            <select class="form-control" id="postVisibility">
              <option value="public">Public</option>
              <option value="friends">Friends Only</option>
              <option value="private">Private</option>
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">Featured Image</label>
            <input type="file" class="form-control" id="postImage" accept="image/*">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" onclick="closeModal('newPostModal')">Cancel</button>
        <button class="btn btn-primary" onclick="submitNewPost()">Publish Post</button>
      </div>
    </div>
  </div>
  
  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>
  
  <script>
    // Initialize Firebase
    var firebaseConfig = {
      apiKey: "AIzaSyAFgxSMtktsqJjcJOMnkTB8yZF6T492gpA",
      authDomain: "fadis-youth.firebaseapp.com",
      databaseURL: "https://fadis-youth-default-rtdb.firebaseio.com",
      projectId: "fadis-youth",
      storageBucket: "fadis-youth.firebasestorage.app",
      messagingSenderId: "1067077305340",
      appId: "1:1067077305340:web:3ca9c71202a8020c6ba879",
      measurementId: "G-Z02SPW9ZKW"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();
    
    let currentUser = null;
    
    // Check authentication state
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        loadUserData();
        loadDashboardStats();
        loadRecentPosts();
        loadRecentActivity();
      } else {
        window.location.href = "login.html";
      }
    });
    
    // Load user data
    function loadUserData() {
      db.collection("users").doc(currentUser.uid).get().then(doc => {
        if (doc.exists) {
          const userData = doc.data();
          
          // Update profile info
          document.getElementById("userName").textContent = userData.displayName || "User";
          document.getElementById("userRole").textContent = userData.role || "Member";
          
          // Update avatar
          const avatar = document.getElementById("userAvatar");
          if (userData.photoURL) {
            avatar.innerHTML = `<img src="${userData.photoURL}" alt="Profile">`;
          } else {
            avatar.textContent = (userData.displayName || "U").charAt(0).toUpperCase();
          }
          
          // Populate profile form
          document.getElementById("firstName").value = userData.firstName || "";
          document.getElementById("lastName").value = userData.lastName || "";
          document.getElementById("displayName").value = userData.displayName || "";
          document.getElementById("email").value = userData.email || "";
          document.getElementById("bio").value = userData.bio || "";
          document.getElementById("location").value = userData.location || "";
          document.getElementById("website").value = userData.website || "";
          document.getElementById("interests").value = userData.interests ? userData.interests.join(", ") : "";
          
          // Set avatar preview
          if (userData.photoURL) {
            document.getElementById("avatarImage").src = userData.photoURL;
          }
          
          // Populate settings
          document.getElementById("settingsEmail").value = userData.email || "";
          document.getElementById("emailNotifications").checked = userData.notifications?.email !== false;
          document.getElementById("pushNotifications").checked = userData.notifications?.push !== false;
          document.getElementById("messageNotifications").checked = userData.notifications?.messages !== false;
          document.getElementById("profileVisibility").value = userData.privacy?.profile || "public";
          document.getElementById("messagePrivacy").value = userData.privacy?.messages || "friends";
        }
      }).catch(error => {
        console.error("Error loading user data:", error);
        showToast("Error loading profile data", "error");
      });
    }
    
    // Load dashboard statistics
    function loadDashboardStats() {
      // Posts count
      db.collection("posts").where("authorUID", "==", currentUser.uid).get().then(snapshot => {
        document.getElementById("postsCount").textContent = snapshot.size;
      });
      
      // Followers count
      db.collection("follows").where("following", "==", currentUser.uid).get().then(snapshot => {
        document.getElementById("followersCount").textContent = snapshot.size;
      });
      
      // Following count
      db.collection("follows").where("follower", "==", currentUser.uid).get().then(snapshot => {
        document.getElementById("followingCount").textContent = snapshot.size;
      });
      
      // Likes count (sum of all likes on user's posts)
      db.collection("posts").where("authorUID", "==", currentUser.uid).get().then(snapshot => {
        let totalLikes = 0;
        snapshot.forEach(doc => {
          totalLikes += doc.data().likesCount || 0;
        });
        document.getElementById("likesCount").textContent = totalLikes;
      });
    }
    
    // Load recent posts
    function loadRecentPosts() {
      const postsList = document.getElementById("userPostsList");
      postsList.innerHTML = "";
      
      db.collection("posts")
        .where("authorUID", "==", currentUser.uid)
        .orderBy("timestamp", "desc")
        .limit(5)
        .get()
        .then(snapshot => {
          if (snapshot.empty) {
            postsList.innerHTML = "<li>No posts found. Create your first post!</li>";
            return;
          }
          
          snapshot.forEach(doc => {
            const post = doc.data();
            const postTime = post.timestamp ? new Date(post.timestamp.toDate()).toLocaleString() : "Just now";
            
            postsList.innerHTML += `
              <li class="post-item">
                <div class="post-header">
                  <h3 class="post-title">${post.topic || "Untitled"}</h3>
                  <div class="post-meta">
                    <span><i class="far fa-eye"></i> ${post.views || 0}</span>
                    <span><i class="far fa-heart"></i> ${post.likesCount || 0}</span>
                    <span><i class="far fa-comment"></i> ${post.commentsCount || 0}</span>
                  </div>
                </div>
                <div class="post-content">
                  ${post.body ? post.body.substring(0, 150) + (post.body.length > 150 ? "..." : "") : ""}
                </div>
                <div class="post-actions">
                  <div class="post-action" onclick="editPost('${doc.id}')">
                    <i class="fas fa-edit"></i> Edit
                  </div>
                  <div class="post-action" onclick="viewPost('${doc.id}')">
                    <i class="fas fa-external-link-alt"></i> View
                  </div>
                  <div class="post-action" onclick="deletePost('${doc.id}')">
                    <i class="fas fa-trash"></i> Delete
                  </div>
                </div>
              </li>`;
          });
        })
        .catch(error => {
          console.error("Error loading posts:", error);
          postsList.innerHTML = "<li>Error loading posts. Please try again.</li>";
        });
    }
    
    // Load recent activity
    function loadRecentActivity() {
      // This would be populated from a dedicated activity collection
      // For now, we'll use placeholder data
    }
    
    // Show different dashboard sections
    function showSection(sectionId) {
      // Hide all sections
      document.querySelectorAll('.dashboard-section').forEach(section => {
        section.style.display = 'none';
      });
      
      // Show selected section
      document.getElementById(sectionId + 'Section').style.display = 'block';
      
      // Update page title
      const sectionTitles = {
        'dashboard': 'Dashboard',
        'profile': 'My Profile',
        'posts': 'My Posts',
        'followers': 'My Followers',
        'following': 'People I Follow',
        'notifications': 'Notifications',
        'messages': 'Messages',
        'settings': 'Account Settings'
      };
      
      document.getElementById('pageTitle').textContent = sectionTitles[sectionId];
      
      // Load section-specific data
      switch(sectionId) {
        case 'followers':
          loadFollowers();
          break;
        case 'following':
          loadFollowing();
          break;
        case 'notifications':
          loadNotifications();
          break;
        case 'messages':
          loadMessages();
          break;
      }
    }
    
    // Load followers list
    function loadFollowers() {
      const followersList = document.getElementById("followersList");
      followersList.innerHTML = "<p>Loading followers...</p>";
      
      db.collection("follows")
        .where("following", "==", currentUser.uid)
        .get()
        .then(snapshot => {
          if (snapshot.empty) {
            followersList.innerHTML = "<p>You don't have any followers yet.</p>";
            return;
          }
          
          let html = "";
          snapshot.forEach(doc => {
            const followData = doc.data();
            
            // Get follower user data
            db.collection("users").doc(followData.follower).get().then(userDoc => {
              if (userDoc.exists) {
                const userData = userDoc.data();
                
                html += `
                  <div class="follower-item">
                    <div class="user-avatar">${(userData.displayName || "U").charAt(0).toUpperCase()}</div>
                    <div class="user-info">
                      <div class="user-name">${userData.displayName || "User"}</div>
                      <div class="follow-time">Following since ${followData.timestamp?.toDate().toLocaleDateString() || "recently"}</div>
                    </div>
                    <button class="btn btn-outline">Message</button>
                  </div>`;
                
                followersList.innerHTML = html;
              }
            });
          });
        })
        .catch(error => {
          console.error("Error loading followers:", error);
          followersList.innerHTML = "<p>Error loading followers. Please try again.</p>";
        });
    }
    
    // Load following list
    function loadFollowing() {
      const followingList = document.getElementById("followingList");
      followingList.innerHTML = "<p>Loading following...</p>";
      
      db.collection("follows")
        .where("follower", "==", currentUser.uid)
        .get()
        .then(snapshot => {
          if (snapshot.empty) {
            followingList.innerHTML = "<p>You're not following anyone yet.</p>";
            return;
          }
          
          let html = "";
          snapshot.forEach(doc => {
            const followData = doc.data();
            
            // Get followed user data
            db.collection("users").doc(followData.following).get().then(userDoc => {
              if (userDoc.exists) {
                const userData = userDoc.data();
                
                html += `
                  <div class="following-item">
                    <div class="user-avatar">${(userData.displayName || "U").charAt(0).toUpperCase()}</div>
                    <div class="user-info">
                      <div class="user-name">${userData.displayName || "User"}</div>
                      <div class="follow-time">Following since ${followData.timestamp?.toDate().toLocaleDateString() || "recently"}</div>
                    </div>
                    <button class="btn btn-outline" onclick="unfollowUser('${followData.following}')">Unfollow</button>
                  </div>`;
                
                followingList.innerHTML = html;
              }
            });
          });
        })
        .catch(error => {
          console.error("Error loading following:", error);
          followingList.innerHTML = "<p>Error loading following. Please try again.</p>";
        });
    }
    
    // Unfollow a user
    function unfollowUser(userId) {
      if (!confirm("Are you sure you want to unfollow this user?")) return;
      
      db.collection("follows")
        .where("follower", "==", currentUser.uid)
        .where("following", "==", userId)
        .get()
        .then(snapshot => {
          snapshot.forEach(doc => {
            doc.ref.delete().then(() => {
              showToast("Unfollowed successfully", "success");
              loadFollowing();
              loadDashboardStats();
            });
          });
        })
        .catch(error => {
          console.error("Error unfollowing user:", error);
          showToast("Error unfollowing user", "error");
        });
    }
    
    // Load notifications
    function loadNotifications() {
      const notificationsList = document.getElementById("notificationsList");
      notificationsList.innerHTML = "<p>Loading notifications...</p>";
      
      // This would query a notifications collection
      // For now, we'll use placeholder data
      setTimeout(() => {
        notificationsList.innerHTML = `
          <div class="notification-item">
            <div class="notification-icon"><i class="fas fa-heart"></i></div>
            <div class="notification-content">
              <p>Ahmed Ali liked your post "Ramadan Preparation Tips"</p>
              <div class="notification-time">2 hours ago</div>
            </div>
          </div>
          <div class="notification-item">
            <div class="notification-icon"><i class="fas fa-user-plus"></i></div>
            <div class="notification-content">
              <p>Mariam Yusuf started following you</p>
              <div class="notification-time">5 hours ago</div>
            </div>
          </div>
          <div class="notification-item">
            <div class="notification-icon"><i class="fas fa-comment"></i></div>
            <div class="notification-content">
              <p>Ibrahim Omar commented on your post</p>
              <div class="notification-time">1 day ago</div>
            </div>
          </div>`;
      }, 500);
    }
    
    // Load messages
    function loadMessages() {
      const messagesContainer = document.querySelector("#messagesSection .messages-container");
      messagesContainer.innerHTML = "<p>Loading messages...</p>";
      
      // This would query a messages collection
      // For now, we'll use placeholder data
      setTimeout(() => {
        messagesContainer.innerHTML = `
          <div class="message-item">
            <div class="message-avatar">A</div>
            <div class="message-content">
              <div class="message-header">
                <div class="message-sender">Ahmed Ali</div>
                <div class="message-time">2 hours ago</div>
              </div>
              <div class="message-text">Salam, how are you doing?</div>
            </div>
          </div>
          <div class="message-item">
            <div class="message-avatar">M</div>
            <div class="message-content">
              <div class="message-header">
                <div class="message-sender">Mariam Yusuf</div>
                <div class="message-time">1 day ago</div>
              </div>
              <div class="message-text">Thank you for your post, it was very helpful!</div>
            </div>
          </div>`;
      }, 500);
    }
    
    // Show new post modal
    function showNewPostModal() {
      document.getElementById("newPostModal").classList.add("active");
    }
    
    // Close modal
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove("active");
    }
    
    // Submit new post
    function submitNewPost() {
      const title = document.getElementById("postTitle").value.trim();
      const content = document.getElementById("postContent").value.trim();
      const tags = document.getElementById("postTags").value.split(",").map(tag => tag.trim());
      const visibility = document.getElementById("postVisibility").value;
      const imageFile = document.getElementById("postImage").files[0];
      
      if (!title || !content) {
        showToast("Please fill in all required fields", "warning");
        return;
      }
      
      // First upload image if selected
      if (imageFile) {
        const storageRef = storage.ref().child(`posts/${currentUser.uid}/${Date.now()}_${imageFile.name}`);
        storageRef.put(imageFile).then(snapshot => {
          return snapshot.ref.getDownloadURL();
        }).then(imageUrl => {
          createPost(title, content, tags, visibility, imageUrl);
        }).catch(error => {
          console.error("Error uploading image:", error);
          showToast("Error uploading image", "error");
        });
      } else {
        createPost(title, content, tags, visibility);
      }
    }
    
    // Create post in Firestore
    function createPost(title, content, tags, visibility, imageUrl = null) {
      const postData = {
        topic: title,
        body: content,
        authorUID: currentUser.uid,
        authorName: currentUser.displayName || "Anonymous",
        authorAvatar: currentUser.photoURL || null,
        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
        likes: [],
        likesCount: 0,
        commentsCount: 0,
        sharesCount: 0,
        views: 0,
        tags: tags,
        visibility: visibility,
        keywords: (title + " " + content).toLowerCase().split(/\s+/)
      };
      
      if (imageUrl) {
        postData.imageUrl = imageUrl;
      }
      
      db.collection("posts").add(postData)
        .then(() => {
          closeModal("newPostModal");
          document.getElementById("newPostForm").reset();
          showToast("Post created successfully", "success");
          loadRecentPosts();
          loadDashboardStats();
        })
        .catch(error => {
          console.error("Error creating post:", error);
          showToast("Error creating post", "error");
        });
    }
    
    // Edit post
    function editPost(postId) {
      // This would open an edit modal with the post data
      showToast("Edit post functionality will be implemented here", "info");
    }
    
    // View post
    function viewPost(postId) {
      window.open(`post.html?id=${postId}`, '_blank');
    }
    
    // Delete post
    function deletePost(postId) {
      if (!confirm("Are you sure you want to delete this post? This action cannot be undone.")) return;
      
      db.collection("posts").doc(postId).delete()
        .then(() => {
          showToast("Post deleted successfully", "success");
          loadRecentPosts();
          loadDashboardStats();
        })
        .catch(error => {
          console.error("Error deleting post:", error);
          showToast("Error deleting post", "error");
        });
    }
    
    // Save profile changes
    function saveProfile() {
      const firstName = document.getElementById("firstName").value.trim();
      const lastName = document.getElementById("lastName").value.trim();
      const displayName = document.getElementById("displayName").value.trim();
      const email = document.getElementById("email").value.trim();
      const bio = document.getElementById("bio").value.trim();
      const location = document.getElementById("location").value.trim();
      const website = document.getElementById("website").value.trim();
      const interests = document.getElementById("interests").value.split(",").map(item => item.trim());
      
      if (!firstName || !lastName || !displayName || !email) {
        showToast("Please fill in all required fields", "warning");
        return;
      }
      
      const updateData = {
        firstName: firstName,
        lastName: lastName,
        displayName: displayName,
        email: email,
        bio: bio,
        location: location,
        website: website,
        interests: interests,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      // Update email in Firebase Auth if changed
      if (email !== currentUser.email) {
        currentUser.updateEmail(email).catch(error => {
          console.error("Error updating email:", error);
          showToast("Error updating email. Please reauthenticate.", "error");
        });
      }
      
      // Update Firestore user document
      db.collection("users").doc(currentUser.uid).update(updateData)
        .then(() => {
          showToast("Profile updated successfully", "success");
          loadUserData();
        })
        .catch(error => {
          console.error("Error updating profile:", error);
          showToast("Error updating profile", "error");
        });
    }
    
    // Save settings
    function saveSettings() {
      const email = document.getElementById("settingsEmail").value.trim();
      const currentPassword = document.getElementById("currentPassword").value;
      const newPassword = document.getElementById("newPassword").value;
      const confirmPassword = document.getElementById("confirmPassword").value;
      
      const emailNotifications = document.getElementById("emailNotifications").checked;
      const pushNotifications = document.getElementById("pushNotifications").checked;
      const messageNotifications = document.getElementById("messageNotifications").checked;
      
      const profileVisibility = document.getElementById("profileVisibility").value;
      const messagePrivacy = document.getElementById("messagePrivacy").value;
      
      const updateData = {
        notifications: {
          email: emailNotifications,
          push: pushNotifications,
          messages: messageNotifications
        },
        privacy: {
          profile: profileVisibility,
          messages: messagePrivacy
        },
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      };
      
      // Update email if changed
      if (email !== currentUser.email) {
        currentUser.updateEmail(email).catch(error => {
          console.error("Error updating email:", error);
          showToast("Error updating email. Please reauthenticate.", "error");
        });
      }
      
      // Update password if all password fields are filled
      if (currentPassword && newPassword && confirmPassword) {
        if (newPassword !== confirmPassword) {
          showToast("New passwords don't match", "warning");
          return;
        }
        
        const credential = firebase.auth.EmailAuthProvider.credential(
          currentUser.email, 
          currentPassword
        );
        
        currentUser.reauthenticateWithCredential(credential)
          .then(() => {
            return currentUser.updatePassword(newPassword);
          })
          .then(() => {
            showToast("Password updated successfully", "success");
          })
          .catch(error => {
            console.error("Error updating password:", error);
            showToast("Error updating password. Please check your current password.", "error");
          });
      }
      
      // Update Firestore user document
      db.collection("users").doc(currentUser.uid).update(updateData)
        .then(() => {
          showToast("Settings updated successfully", "success");
        })
        .catch(error => {
          console.error("Error updating settings:", error);
          showToast("Error updating settings", "error");
        });
    }
    
    // Handle avatar upload
    document.getElementById("avatarUpload").addEventListener("change", function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(event) {
        document.getElementById("avatarImage").src = event.target.result;
        
        // Upload to Firebase Storage
        const storageRef = storage.ref().child(`avatars/${currentUser.uid}/${file.name}`);
        storageRef.put(file).then(snapshot => {
          return snapshot.ref.getDownloadURL();
        }).then(downloadURL => {
          // Update user's photoURL in Firestore and Firebase Auth
          const updates = {
            photoURL: downloadURL,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          };
          
          db.collection("users").doc(currentUser.uid).update(updates);
          currentUser.updateProfile({ photoURL: downloadURL });
          
          showToast("Profile picture updated successfully", "success");
          loadUserData();
        }).catch(error => {
          console.error("Error uploading avatar:", error);
          showToast("Error uploading profile picture", "error");
        });
      };
      reader.readAsDataURL(file);
    });
    
    // Logout
    function logout() {
      auth.signOut().then(() => {
        window.location.href = "login.html";
      }).catch(error => {
        console.error("Error signing out:", error);
        showToast("Error signing out", "error");
      });
    }
    
    // Show toast notification
    function showToast(message, type = "info") {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.className = "toast";
      toast.classList.add(type);
      
      setTimeout(() => {
        toast.classList.add("show");
      }, 100);
      
      setTimeout(() => {
        toast.classList.remove("show");
      }, 3000);
    }
    
    // Initialize the dashboard
    document.addEventListener('DOMContentLoaded', function() {
      // Set active menu item based on URL hash
      const hash = window.location.hash.substring(1);
      if (hash) {
        showSection(hash);
      }
      
      // Close modals when clicking outside
      document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', function(e) {
          if (e.target === modal) {
            modal.classList.remove('active');
          }
        });
      });
    });
  </script>
</body>
</html>
