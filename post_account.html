<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Post Management</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #1877f2;
      --danger-color: #dc3545;
      --success-color: #28a745;
      --background-color: #f8f9fa;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background: var(--background-color);
    }
    /* Mobile First Layout */
    .management-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .mobile-menu-btn {
      display: block;
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 1000;
      background: var(--primary-color);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 50%;
      font-size: 1.2rem;
    }
    .sidebar {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      width: 250px;
      background: white;
      padding: 20px;
      box-shadow: 2px 0 5px rgba(0,0,0,0.1);
      z-index: 999;
    }
    .sidebar.active {
      display: block;
    }
    .main-content {
      padding: 1rem;
      margin-top: 60px;
    }
    /* Post Card Styles */
    .post-card {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    /* Responsive Tables */
    @media (max-width: 768px) {
      .post-meta {
        flex-direction: column;
      }
      .search-bar {
        width: 100% !important;
      }
    }
    /* Tablet and Desktop Styles */
    @media (min-width: 768px) {
      .management-container {
        flex-direction: row;
      }
      .mobile-menu-btn {
        display: none;
      }
      .sidebar {
        display: block;
        position: relative;
        height: auto;
        box-shadow: none;
      }
      .main-content {
        flex: 1;
        padding: 2rem;
        margin-top: 0;
      }
      .post-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
      }
    }
    /* Common Styles */
    .sidebar-menu {
      list-style: none;
      margin-top: 2rem;
    }
    .sidebar-item {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .sidebar-item.active {
      background: var(--primary-color);
      color: white;
    }
    .management-header {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    .search-bar {
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 20px;
      width: 100%;
    }
    .post-filters {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }
    .filter-btn {
      padding: 8px 15px;
      border: 1px solid #ddd;
      border-radius: 20px;
      cursor: pointer;
      background: white;
    }
    .filter-btn.active {
      background: var(--primary-color);
      color: white;
    }
    .post-status {
      font-size: 0.8em;
      padding: 4px 8px;
      border-radius: 4px;
      margin-bottom: 10px;
      display: inline-block;
    }
    .published { background: var(--success-color); color: white; }
    .draft { background: #6c757d; color: white; }
    .scheduled { background: #ffc107; color: black; }
    .post-actions {
      display: flex;
      gap: 8px;
      margin-top: 15px;
    }
    .action-btn {
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #ddd;
      background: white;
      transition: all 0.3s;
    }
    /* Modals */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      width: 95%;
      max-width: 500px;
    }
  </style>
</head>
<body>
  <button class="mobile-menu-btn" onclick="toggleSidebar()">â˜°</button>
  
  <div class="management-container">
    <nav class="sidebar">
      <h2>Dashboard</h2>
      <ul class="sidebar-menu">
        <li class="sidebar-item active">Posts</li>
        <li class="sidebar-item">Analytics</li>
        <li class="sidebar-item">Scheduled</li>
        <li class="sidebar-item">Drafts</li>
        <li class="sidebar-item">Settings</li>
      </ul>
    </nav>

    <main class="main-content">
      <div class="management-header">
        <h1>Post Management</h1>
        <input type="text" class="search-bar" placeholder="Search posts...">
      </div>

      <div class="post-filters">
        <button class="filter-btn active">All</button>
        <button class="filter-btn">Published</button>
        <button class="filter-btn">Drafts</button>
        <button class="filter-btn">Scheduled</button>
      </div>

      <!-- This container will be dynamically filled with the user's posts -->
      <div class="post-grid" id="postGrid"></div>
    </main>
  </div>

  <!-- Edit Post Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Post</h3>
        <span class="close-btn" onclick="closeModal()">&times;</span>
      </div>
      <form id="editForm">
        <label>Title</label>
        <input type="text" id="editTitle" class="search-bar" placeholder="Post title">
        <label>Content</label>
        <textarea id="editContent" class="search-bar" rows="4" placeholder="Post content"></textarea>
        <label>Visibility</label>
        <select id="editVisibility">
          <option value="public">Public</option>
          <option value="private">Private</option>
          <option value="followers">Followers Only</option>
        </select>
        <div class="post-actions" style="margin-top: 1rem;">
          <button type="button" class="action-btn" onclick="closeModal()">Cancel</button>
          <button type="submit" class="action-btn" style="background: var(--primary-color); color: white;">Save</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Stats Modal (Example) -->
  <div class="modal" id="statsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Post Analytics</h3>
        <span class="close-btn" onclick="closeModal()">&times;</span>
      </div>
      <div class="post-meta">
        <div><strong>1,234</strong> Views</div>
        <div><strong>256</strong> Likes</div>
        <div><strong>89</strong> Comments</div>
      </div>
    </div>
  </div>

  <script>
    /* ------------------ Basic UI Functions (from your design code) ------------------ */
    function toggleSidebar() {
      document.querySelector('.sidebar').classList.toggle('active');
    }
    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'flex';
    }
    function closeModal() {
      document.querySelectorAll('.modal').forEach(modal => {
        modal.style.display = 'none';
      });
    }
    document.querySelector('.search-bar').addEventListener('input', (e) => {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll('.post-card').forEach(card => {
        const title = card.querySelector('h3') ? card.querySelector('h3').textContent.toLowerCase() : "";
        card.style.display = title.includes(term) ? 'block' : 'none';
      });
    });
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        // Filtering functionality can be extended here.
      });
    });
    window.onclick = function(e) {
      if (e.target.classList.contains('modal')) closeModal();
    };

    /* ------------------ Firebase Integration ------------------ */
    // Initialize Firebase using your provided configuration.
    var firebaseConfig = {
      apiKey: "AIzaSyAFgxSMtktsqJjcJOMnkTB8yZF6T492gpA",
      authDomain: "fadis-youth.firebaseapp.com",
      databaseURL: "https://fadis-youth-default-rtdb.firebaseio.com",
      projectId: "fadis-youth",
      storageBucket: "fadis-youth.firebasestorage.app",
      messagingSenderId: "1067077305340",
      appId: "1:1067077305340:web:3ca9c71202a8020c6ba879",
      measurementId: "G-Z02SPW9ZKW"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;
    let currentEditPostId = null;

    // Check authentication
    auth.onAuthStateChanged(function(user) {
      if (user) {
        currentUser = user;
        // Optionally, update the account icon with the first letter of the user's display name.
        document.querySelector('.account-icon').innerText = (user.displayName || "A").charAt(0).toUpperCase();
        loadPosts();
      } else {
        // If not logged in, prompt the user.
        if (confirm("You are not logged in. Do you want to log in?")) {
          window.location.href = "login.html";
        } else {
          // In read-only mode, load posts (if you wish to show public posts)
          loadPosts();
        }
      }
    });

    // Load posts created by the current user
    function loadPosts() {
      // Clear the grid first.
      document.getElementById("postGrid").innerHTML = "";
      if (currentUser) {
        db.collection("posts")
          .where("authorUID", "==", currentUser.uid)
          .orderBy("timestamp", "desc")
          .onSnapshot(snapshot => {
            if (snapshot.empty) {
              document.getElementById("postGrid").innerHTML = "<p style='text-align:center;'>No posts yet.</p>";
              return;
            }
            let html = "";
            snapshot.forEach(doc => {
              const post = doc.data();
              // Render each post using the design. We'll add a data attribute for the document id.
              html += renderPost(doc.id, post);
            });
            document.getElementById("postGrid").innerHTML = html;
          });
      } else {
        document.getElementById("postGrid").innerHTML = "<p style='text-align:center;'>Please log in to manage your posts.</p>";
      }
    }

    // Render a post card (integrating your design)
    function renderPost(id, post) {
      // For demonstration, we assume each post document has: topic, body, privacy, trashed (boolean), timestamp, likesCount, and optionally authorAvatar and authorName.
      let timeString = post.timestamp ? new Date(post.timestamp.toDate()).toLocaleString() : "Just now";
      let avatarHTML = "";
      if (post.authorAvatar) {
        avatarHTML = `<img src="${post.authorAvatar}" alt="Avatar" class="author-avatar">`;
      } else {
        const name = post.authorName || "A";
        const hue = Math.floor(Math.random() * 360);
        avatarHTML = `<div class="author-avatar" style="background: hsl(${hue}, 70%, 80%); color: #1c1e21;">${name.charAt(0).toUpperCase()}</div>`;
      }
      // Privacy selector to update visibility
      let privacyHTML = `<div class="privacy-selector">
                           <label>Visibility:
                             <select onchange="updatePrivacy('${id}', this.value)">
                               <option value="public" ${post.privacy==="public"?"selected":""}>Public</option>
                               <option value="private" ${post.privacy==="private"?"selected":""}>Private</option>
                               <option value="followers" ${post.privacy==="followers"?"selected":""}>Followers Only</option>
                             </select>
                           </label>
                         </div>`;
      // Controls: if the post is trashed, show Restore button; otherwise, show Edit and Delete buttons.
      let controlsHTML = "";
      if (!post.trashed) {
        controlsHTML = `<div class="post-controls">
                          <button class="btn-control edit" onclick="openEditModal('${id}')">Edit</button>
                          <button class="btn-control delete" onclick="deletePost('${id}')">Delete</button>
                        </div>`;
      } else {
        controlsHTML = `<div class="post-controls">
                          <button class="btn-control restore" onclick="restorePost('${id}')">Restore</button>
                        </div>`;
      }
      // Build and return the complete post card HTML.
      return `
      <div class="post-card" id="post-${id}">
        <div class="post-header">
          ${avatarHTML}
          <div class="author-info">
            <div class="author-name">${post.authorName || "Anonymous"}</div>
            <div class="post-time">${timeString}</div>
          </div>
        </div>
        <div class="post-content">
          <h2>${post.topic || "Untitled"}</h2>
          <p>${post.body || ""}</p>
          ${privacyHTML}
        </div>
        <div class="post-actions">
          <div class="action-btn like-btn" onclick="toggleLike(event, '${id}')">
            <i class="far fa-heart"></i>
            <span class="like-count">${post.likesCount || 0}</span>
          </div>
          <div class="action-btn" onclick="toggleComments(event, '${id}')">
            <i class="far fa-comment"></i> Comment
          </div>
          <div class="action-btn" onclick="sharePost(event, '${id}')">
            <i class="fas fa-share"></i> Share
          </div>
        </div>
        ${controlsHTML}
      </div>`;
    }

    // Update privacy setting of a post
    function updatePrivacy(postId, privacySetting) {
      db.collection("posts").doc(postId).update({ privacy: privacySetting })
        .then(() => { alert("Privacy updated."); })
        .catch(err => console.error("Error updating privacy:", err));
    }

    // Toggle Like for a post
    function toggleLike(e, postId) {
      e.stopPropagation();
      if (!currentUser) { alert("Please log in to like posts."); return; }
      const user = currentUser;
      const postRef = db.collection("posts").doc(postId);
      postRef.get().then(doc => {
        if (doc.exists) {
          let data = doc.data();
          let likes = data.likes || [];
          if (likes.includes(user.uid)) {
            likes = likes.filter(uid => uid !== user.uid);
          } else {
            likes.push(user.uid);
          }
          postRef.update({ likes: likes, likesCount: likes.length });
        }
      });
    }

    // Delete (trash) a post
    function deletePost(postId) {
      if (confirm("Are you sure you want to delete this post? It will be moved to trash.")) {
        db.collection("posts").doc(postId).update({
          trashed: true,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => { alert("Post moved to trash."); });
      }
    }

    // Restore a trashed post
    function restorePost(postId) {
      if (confirm("Restore this post?")) {
        db.collection("posts").doc(postId).update({
          trashed: false,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => { alert("Post restored."); });
      }
    }

    // --- Edit Post Modal Functions ---
    function openEditModal(postId) {
      currentEditPostId = postId;
      db.collection("posts").doc(postId).get().then(doc => {
        if (doc.exists) {
          const post = doc.data();
          document.getElementById("editTitle").value = post.topic || "";
          document.getElementById("editContent").value = post.body || "";
          document.getElementById("editVisibility").value = post.privacy || "public";
          openModal("editModal");
        }
      });
    }
    function closeEditModal() {
      closeModal();
      currentEditPostId = null;
    }
    document.getElementById("editForm")?.addEventListener("submit", function(e) {
      e.preventDefault();
      saveEdit();
    });
    function saveEdit() {
      const newTitle = document.getElementById("editTitle").value.trim();
      const newContent = document.getElementById("editContent").value.trim();
      const newVisibility = document.getElementById("editVisibility").value;
      if(newTitle === "" || newContent === "") {
        alert("Title and content cannot be empty.");
        return;
      }
      db.collection("posts").doc(currentEditPostId).update({
        topic: newTitle,
        body: newContent,
        privacy: newVisibility,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        alert("Post updated.");
        closeEditModal();
      }).catch(err => console.error("Error updating post:", err));
    }

    // --- Comment Functions (if needed) ---
    function toggleComments(e, postId) {
      e.stopPropagation();
      // For brevity, you can implement comment toggling if desired.
      // For now, this function can simply alert that comments functionality would go here.
      alert("Comments functionality is not implemented in this placeholder.");
    }

    // --- Share Functionality ---
    function sharePost(e, postId) {
      e.stopPropagation();
      const postURL = window.location.href + "#post-" + postId;
      if (navigator.share) {
        navigator.share({ title: "Check out this post", url: postURL })
          .catch(err => console.error("Error sharing:", err));
      } else {
        navigator.clipboard.writeText(postURL).then(() => {
          alert("Post URL copied to clipboard.");
        });
      }
    }

    // --- Modal Handling (from design code) ---
    function openModal(modalId) {
      document.getElementById(modalId).style.display = 'flex';
    }
    function closeModal() {
      document.querySelectorAll('.modal').forEach(modal => {
        modal.style.display = 'none';
      });
    }
    
    // --- Navigation Modal for Top Navigation ---
    function openNavModalTop() {
      document.getElementById("navModalTop").classList.add("active");
    }
    function closeNavModalTop() {
      document.getElementById("navModalTop").classList.remove("active");
    }
    
    // --- Sparkle Animation (for visual flair) ---
    document.addEventListener('DOMContentLoaded', () => {
      // Delay loading posts until Firebase auth is resolved.
      // Also apply sparkle animation to each post card once rendered.
      // (The loadPosts() function is called on auth state change.)
    });
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</body>
</html>
